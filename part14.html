<!doctype html>
<html lang="en">
<head>
    <title>F20DV Lab 1</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src='https://d3js.org/d3.v7.min.js'></script>
</head>
<body>
    <div class="container my-4">
        <a href="index.html" class="btn btn-outline-secondary float-end">Back to Index</a>

        <h1>F20DV Lab 1</h1>
        <h4 class="text-muted">Colours</h4>
        <p class="lead">Calum Shepherd - H00292866</p>
        <hr />

        <!-- Exercise 28 -->
        <script>
            /**
             * Draws a bar chart from headerless CSV data in the given file
             * @param  {string} file Path to file (must be pushed to github.com/cws3-f20dv/lab1/main)
             */
            function barChart(file)
            {
                d3.text('https://raw.githubusercontent.com/cws3-f20dv/lab1/main/'+file).then(function(d)
                {
                    /*
                     * Using ds3.text and below method to convert to array of numbers
                     * Credit: https://www.jscodetips.com/examples/read-csv-tsv-with-no-header-line-in-d3
                     */
                    data = d3.csvParseRows(d).map(function(r) {
                        // Unary +v converts to number and .map() returns to original object in sequence
                        return r.map(function(v) { return +v; });
                    })[0]; // have to index to first element of object

                    const width     = 500;
                    const barHeight = 20;
                    const margin    = 1;

                    var scale = d3.scaleLinear()
                       .domain([d3.min(data), d3.max(data)])
                       .range([50, 500]);

                    var svg = d3.select("body")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", barHeight * data.length);

                    var g = svg.selectAll("g")
                        .data(data)
                        .enter()
                        .append("g")
                        .attr("transform", function (d, i) {
                          return "translate(0," + i * barHeight + ")";
                        });

                    var colors = d3.scaleLinear().domain([d3.min(data), d3.max(data)]).range(["#ddd", "blue"]);

                    g.append("rect")
                       .attr("width", function (d) {
                         return scale(d);
                       })
                       .attr('fill', function(d)
                        {   // Set colour based on data range
                            return colors(d);
                        })
                       .attr("height", barHeight - margin)

                    g.append("text")
                       .attr("x", function (d) { return (scale(d)); })
                       .attr("y", barHeight / 2)
                       .attr("dy", ".35em")
                       .style('text-anchor', 'end')
                       .text(function (d) { return d; });
                });
            }

            barChart('barchart.csv');


            /* Exercise 29 */
            function drawChart(data)
            {
                // Set Dimensions
                const xSize  = 600;   const ySize  = 600;
                const margin = 40;
                const xMax   = xSize - margin*2;
                const yMax   = ySize - margin*2;

                // Get the 'limits' of the data - the full extent (mins and max)
                // so the plotted data fits perfectly
                const xExtent = d3.extent( data, d=>{ return d.x } );
                const yExtent = d3.extent( data, d=>{ return d.y } );

                // Append SVG Object to the Page
                const svg = d3.select("body")
                .append("svg")
                .attr('width',  xSize  )
                .attr('height', ySize  )
                .append("g")
                .attr("transform","translate(" + margin + "," + margin + ")");

                // X Axis
                const x = d3.scaleLinear()
                .domain([ xExtent[0], xExtent[1] ])
                .range([0, xMax]);

                // bottom
                svg.append("g")
                .attr("transform", "translate(0," + yMax + ")")
                .call(d3.axisBottom(x))
                .attr('color', 'green'); // make bottom axis green

                // top
                svg.append("g")
                .call(d3.axisTop(x));

                // Y Axis
                const y = d3.scaleLinear()
                .domain([ yExtent[0], yExtent[1] ])
                .range([ yMax, 0]);

                // left y axis
                svg.append("g")
                .call(d3.axisLeft(y));

                // right y axis
                svg.append("g")
                .attr("transform", `translate(${yMax},0)`)
                .call(d3.axisRight(y));

                // Add the line
                svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.x)  })
                    .y(function(d) { return y(d.y)  })
                );

                colors = d3.scaleLinear().domain([ yExtent[0], yExtent[1] ]).range(["#ddd", "blue"]);
                svg.selectAll("dot")
                .data(d)
                .enter()
                .append("circle")
                .attr("cx", function (d) { return x(d.x) } )
                .attr("cy", function (d) { return y(d.y) } )
                .attr("r", 5)
                .style("fill", function(d) { return colors(d.y); });
            }

            // Create Random Points
            const numPoints = 100;
            const d      = [];
            for (let i = 0; i < numPoints; i++)  {
                d.push({ x: i/100, y: Math.sin( 6.2 * i/100) });
            }
            drawChart(d);
        </script>
    </div>
</body>
</html>
